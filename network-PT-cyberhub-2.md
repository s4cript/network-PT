Session 2 (ejpt)             |                                                                                  Day2
• Assessment Methodologies   |
-----------------------------|

راح نبدا باللاب الي اسمه


Windows Recon: SMB Discover and Mount  |
---------------------------------------|

وراح نشوف كيف نستعرض المجلدات ونفحصها باذن الله 
اللاب راح يكون ويندوز سيرفر
راح يكون فيه شبكة او نفس الشبكة فيها اجهزة فيها smb protocol
بنحاول نشبك فيها كـ user عادي

بداية راح نفحص كامل الشبكة 
ipconfig عشان نشوف ايبي الشبكة

Network ID : 10.6.17.0/20

ف راح نفحص الان باداة الـ nmap 
ف راح يفحص كامل الشبكة وكل الايبيات الي بهذا الرينج
[nmap -10.6.17.0/20 --open]

طبعا --open 
عشان نحصل الهوستات وكل هوست ايش البورتات المفتوحه على كل هوست

حصلنا هوستين طبعا
10.6.19.147
10.6.17.91
وحصلنا البورتات المفتوحه لكل هوست

طبعا الويندوز عندنا MAP network drive 
نقدر نتصل عن طريقه بالـ SMB
folder : \\$ip_target
Windows: \
Linux: /
ف راح يكون في حالتنا الاتصال على المجلد هذا
\\10.6.19.147

ف عطانا الان access على الشير الان

الان نقدر نستعرض المجلدات واضاف على جهازنا كهارديسك بس انه بجهاز اخر ف حاليا كانك دخلت الملفات الي ظاهره لك بعد الاتصال بالشير بجهاز الضحيه

وانتهى هذا اللاب وعرفنا كيف نحدد الهوستات مع البورتات المفتوحه على كل هوست حصلناه باداة nmap
وكذالك عرفنا كيف نتصل بالشير على الـ windows server

--------------------------
راح نبداء باللاب الثاني  |
[Windows Recon: SMBMap]   |
--------------------------
اللاب هذا معطينا ايبي راح نفحصه بالـ nmap 
[nmap -sV 10.6.19.82]

طبعا الان حصلنا ان الـ SMB open
راح نفحص البورت باداة اسمها SMBMap
هي نفس الويندوزMAP network drive
راح يسمح لنا نتصفح المجلدات الخ ..
المميز فيها انه تسمح لك تسجل باليوزر الديفلوت الي اسمه guest
[smbmap -u guest -p "" -d . -H 10.6.19.82]

بما ان عندنا اليوزر والباسورد باللاب راح نجرب نسجل فيهم ونشوف ايش الفرق
[smbmap -u administrator -p smbserver_771 -d . -H 10.6.19.82]
نلاحظ انها تغيرت الصلاحيات وزادت المجلدات الي عندنا صلاحيه فيها لانه الان مسجلين بيوزر ادمن وليس كقست يوزر

برضو توفر لك الاداة هذي انه تسوي اوامر معينه باستخدام تاق -x
مثلا
[smbmap -u administrator -p smbserver_771 -d . -H 10.6.19.82 -x "dir"]
طبعا استخدمنا امر dir
عشان قاعدين نتعامل مع ويندوز ف التارقت حقنا الان شغال على ويندوز واستعرضنا ايش موجود داخل كل مجلد

حصلنا flag.txt وهذا هو المطلوب
كيف بنقرا الملف ؟
[smbmap -u administrator -p smbserver_771 -d . -H 10.6.19.82 -x "type flag.txt"]
وبكذا قدرنا نقراه وهذي احد مميزات الاداة 

بعد نقدر نرفع ملفات الى جهاز التارقت عشان نفتح لنا backdoor
ف نجرب نسوي ملف فاضي ونجرب نرفعه
[touch backdoor] لانشاء الملف على نظام لينكس
طبعا نحتاج نعطيه مسار كامل الملف من الروت الى الملف
وبالاضافة نحتاج نعطيه الوجهه وين نبي نحفظه
ولابد نختار الوجهة الصحيحه بحيث يكون عندنا صلاحية الكتابة على المجلد المختار نرفع عليه
[smbmap -u administrator -p smbserver_771 -d . -H 10.6.19.82 --upload '/root/backdoor' 'C$\backdoor]
(لابد نكتب نبي نفحفظه وين بالاضافة الى وش نبي نسمي الملف على جهاز الضحيه)

تقدر طبعا تنزل الملف من المجلد الي عليه الشير 
بس هذا عشانه ملف نصي وفقط نحتاج نقراه ماحملناه 
[smbmap -u administrator -p smbserver_771 -d . -H 10.6.19.82 --download "C$\flag.txt"]
الان نزلنا الملف على جهازنا الشخصي نقدر نقراه او نعدله ونرفعه من جديد 

طبعا لابد يكون عندك صلاحيات معينه عشان تقدر تحمل او ترفع على ال SMB server
نحتاج يكون معنا READ , WRITE permissions
--------------------------
راح نبداء باللاب الثالث |
[Samba Recon: Basics]    |
--------------------------

اللاب هذا راح يكون عن الـ Samba protocol 
هو نفسه SMB 
لكن على اللينكس يختلف المسمى

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap -sV 192.132.114.0/24]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.132.114.3]

وحصلنا الـ Samba 
طبعا فيه nmap script 
يعطيك الاصدار تبع الـ samba
[nmap -sV --script smb-os-discovery -p 445 192.132.114.3]
طبعا اخذنا ايش يعني سكربت وكيف تحصلهم في المحاضره الاولى
طبعا الفائدة من معرفة الاصدار
- search about CVEs
- search about default credentials

طبعا فيه اداة ثانيه بنستخدمها الي هي nmblookup 
[nmblookup -A 192.132.114.3] 
نفس فكرة سكربتات ال nmap 
لكن اداة ثانيه عشان ممكن ماتحصلها اساسا في نظام تشغيل اخر ف يكون فيه بديل

طبعا هذي اداة ثالثه كذالك نفس المخرجات
[smbclient -L 192.132.114.3 -N]
-N = no username,password ف بيستخدم الديفولت الي هو guest

اخر اداة نفس فكرة smbclient 
[rpcclient -U "" 192.132.114.3 -N]
-U = username طبعا خليناه فاضي ف بيسجل كـ guset

طبعا الـ guest مش دائما راح تشوفه موجود
يعني بالحياة الواقعيه والسيناريو الحقيقي ماراح تحصل الخطاء هذا 
او نادر تحصله اصلا 

--------------------------
راح نبداء باللاب الرابع |
[Samba Recon: Basics||]  |
--------------------------
طبعا الان بنستخدم اداة تسهل علينا كل الي قبل نفس وظيفة الادوات السابقة والسكربتات 
كلها مجمعينها بهذي الادة الي اسمها enum4linux

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap 192.134.22.0/24 --open]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.134.122.3]

راح نجرب نستخدم اولا اداة rpcclient
[rpcclient -U "" 192.134.122.3 -N]
طبعا هذا الي وقفنا عليه باللاب السابق
طبعا الان راح نجرب نستخدم الاوامر المتاحه في الاداة
عشان نشوف كل الاوامر نكتب
[help]

راح نجرب اول امر بعد ماتتصل بالشير راح تكتب هذا الامر
[srvinfo] راح يعطينا معلومات عن السيرفر 

الان نبدا بالاداة العظيمة enum4linux

[enum4linux -o 192.134.122.3]
هذا الامر عشان يعطينا معلومات عن نظام التشغيل 

الان راح نرجع نستخدم smbclient 
[smbclient -L 192.134.122.3 -N]
الان نحصل المجلدات الي بالسيرفر

طبعا فيه طريقة اخرى الي هي عن طريق metasploit framework
[msfconsole] عشان نفتح الاداة او الفريم وورك 

طبعا اذا حبينا ندخل موديل معين نستخدم امر
[use] متبوع بمسار الموديول

كذالك نقدر نبحث عن الموديول عن طريق امر
[search] متبوع بالاسم 

طبعا راح نستخدم موديول معين الي هو
[use auxiliary/scanner/smb/smb2]
عشان نشوف هل هو يستخدم الاصدار الثاني من ال smb

طبعا مافي غير اصدارين للـ SMB 1,2
ففي حال الموديل قال انه مايستخدم الاصدار الثاني راح نعرف انه الاصدار الاول 

فيه عندنا متغييرات معينه لابد نحط لها قيم معينه
ف عشان نشوف المتغيرات بعد ماندخل الموديول بالامر السابق نستخدم هذا الامر
[show options]

طبعا الام المطلوب زي ماهو واضح لنا انه فقط الـ RHOST 
وهذا يعني ايبي الضحية 
نستخدم الامر هذا عشان نسند قيمه للمتغيرات
[set]

ففي حالتنا بنحتاج نضيف القيمة حقتنا الى المتغير RHOST
[set RHOST 192.134.122.3]
بعدها نشغله باحد الامرين
[exploit] or [run]

طبعا الفريم وورك هذا مقارب جدا لسكربتات حقت nmap 
فبتحصل كثير موديول تستخدمها بنفس الطريقه 

بنجرب معكم الموديول هذا
وعشان شرحنا مسبقا الاوامر راح اكتب الاوامر مباشره بدون شرح لها لانه نفس الشرح فقط راح اشرح وظيفة الموديول

[use auxiliary/scanner/smb/smb_enumusers]
هذا طبعا عشان يطلع اليوزرات الموجوده فبيسهل عليك طريق الـ brute force 
[set RHOST 192.134.122.3]
[exploit] or [run]
والان نحصل اليوزر طلعها لنا

وكذالك اداة enum4linux 
عندها نفس الوظيفة
[enum4linux -U 192.134.122.3]
ونلاحظ انه عطانا اليوزرات الموجوده نفس metasploit framework

وكذالك اداة rpcclient 
راح تعطيك نفس النتيجة
[rpcclient -U "" -N 192.134.122.3]
[enumdomusers] هذا الامر عشان يعطيك اليوزرات
[lookupnames admin] هذا الامر عشان يحصلك التوكن تبع الادمن او الـ SID

--------------------------|
راح نبداء باللاب الخامس  |
[Samba Recon: Basics|||]  |
--------------------------|

طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap 192.17.115.0/24 --open]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.17.115.3]

الان بنشوف المجلدات على ال SMB server
بنستخدم اداة enum4linux
[enum4linux -S 192.17.115.3]

الان نبي نشوف القروبات 
[enum4linux -G 192.17.115.3]

طبعا اكثر شي ممكن نستفيد منه اليوزرات ونسوي بروت فورس او تخمين على اليوزر لكن القروب مش مره مفيد لك كمختبر اختراق

الان بنشوف الـ smbclient
نبي ندخل مجلد معين اسمه public
فعشان معنا null session 
نقدر ندخله لو مافي السيشن هذي بنحتاج اليوزر والباسورد

[smbclient //192.17.115.3/public]
لاحظ استخدمنا /
لانه قاعجين نتعامل مع لينكس ف الان دخلنا المجلد ارفقنا اسمه بعد الايبي وفصلنا بالسلاش
طبعا نكتب help عشان نشوف الاوامر الي عندنا
[help]
نجرب الاوامر التاليه
[ls] عشان يعرض لنا الملفات او ايش محتى المجلد هذا
[cd] راح يغير مكاننا لمجلد اخر مثلا نبي نروح لمجلد الـ secret
[cd secret]
الان حصلنا flag
وهذا المطلوب انه نقرا هذا الملف طبعا اداة الـ smbclient server
مافيه امر cat 
ف ماراح نقدر نقراه ف نحتاج نحمله راح نستخدم get
[get flag]
الان اخذناه على جهازنا نقدر نقراه 
[cat flag]

--------------------------|
راح نبداء باللاب السادس  |
[Samba Recon: Dictionary Attack]
--------------------------|
طبعا في هذا اللاب ماعطانا تارقت معين فراح نفحص كامل الشبكة 
[nmap 192.218.190.0/24 --open]

طبعا اختصار للوقت نعرف ان التارقت حقنا في هذا اللاب
[target: 192.218.190.3]


طبعا اللاب هذا مامعنا الباسورد فقط اليوزر ف بنجرب موديولز مع بعض 
[use auxiliary/scanner/smb/smb_login]
هذا الموديول عشان نسوي broute force 
ف نشوف ايش الاشياء المطلوبه
[show options]
[set rhost 192.218.190.3] نحدد ايبي الضحيه
[set SMBuser jane] طبعا اليوز معنا من اللاب نفسه 
[set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt] هنا نحدد الملف الي فيه الباسوردات الي نبي نجربها على اليوزر ف راح يجرب لنا كل باسورد داخل هذا الملف على اليوزر الي حددناه
[exploit] or [run]
والان راح يبدا يجرب واحد واحد لين يحصله لنا
نشوف الان انه حصل لنا الباسورد 
[password it's: abc123 ]

الان بنجرب نفس الطريقة بس باداة ثانيه التنين hydra 

hydar اداة لتخمين او انها تجرب حسب المعطيات
ف مثلا تعطيها يوزر وتخمن الباسورد او العكس او كلهم 
[hydra -l admin -P /usr/share/wordlists/metasploit/unix_passwords.txt 192.218.190.3 smb]
[-l] عشان نحدد اليوزر
[-L] عشان نحدد الليسته حقت اليوزرات
[-p] عشان نحدد له باسورد
[-P] عشان نحدد الليسته حقت الباسوردات
[smb] الي هي اخر شي عشان تحدد له ايش الخدمة الي تبي يسوي عليه التخمين
ف لازم ننتبه انه يفرق الكبتل والسمول في الاوبشن حقت الاداة
[password it's: password1 ]
طبعا الان مانقدر نسجل بالـ null session 
راح نستهدم اداة smbmap
[smbmap -H 192.218.190.3 -u admin -p password1]
والان عطانا ايش المجلدات الموجوده

بنجرب بيوزر jane 
باستخدام اداة smbclient
[smbclient -L 192.218.190.3 -U jane]
بيطلب الباسورد نعطيه
[abc123]
الان شفنا المجلدات وصلاحيات jane على كل مجلد

الان بنشوف وش موجود داخل المجلد حق jane
باستخدام اداة smbclient
[smbclient //192.218.190.3/jane -U jane]
بعدها نعطيه الباسورد
[abc123]
وراح نحصل الفلاق
طبعا فيه تريك بعد ماتدخل عشان تقرا الفلاق ف اكتشفوا التريك 

--------------------------|
راح نبداء باللاب السابع  |
[ProFTP Recon: Basics]    |
--------------------------|
طبعا الان بنواجه نفس الحاله الي واجهناها مع smb
انه يكون عندنا null session 

وتسمى بالبروتوكول FTP
anonymous login 
ف راح تقدر تسجل بيوزر وباسورد معروفه الي هي تجي دايركت يعني مع البروتوكول
ويشتغل على بورت 21
طبعا يعتبر misconfiguration 

راح نسوي نفس الطريقة
نفحص الشبكة ونشوف ايش الهوست الي شغال عليه FTP service
[nmap -sV 192.216.65.3]
بعدها راح نحصل ان البورت 21 مفتوح
بنجرب معكم هايدرا لنخمن الباسورد واليوزر
[hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 192.216.65.3 -t 4 ftp]
[-t 4] نحدد الـ thrat عشان يكون اسرع
ونشوف انه حصلنا لنا يوزرين بسرعه ف هذت يحكي لك قوة هالاداة
فيه اكثر لو تنتظر بتحصل 7 

طبعا كيف نشبك على الـ FTP
بهذي الطريقه
[ftp 192.216.65.3]
بيطلب منك اليوزر تعطيه اليوزر مثلا مطلوب منا
username: auditor
password: chocolate
الان سجلنا نستعرض الملفات بنحصل
[secret.txt]
طبعا مافي هنا لا cat , type
ف بنستخدم get 
[get secret.txt]
والان نقدر نقراه

اعتذر على الاطالة

@s4cript | @cyberhub | @0xNawaF1
